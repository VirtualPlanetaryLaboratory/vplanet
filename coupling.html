<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Coupling Modules &mdash; VPLanet 2.5.1
 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=d948c9a6" />
      <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=983e91d6"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Adding a New Module" href="module.html" />
    <link rel="prev" title="How to Add a Primary Variable" href="primaryvariable.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            VPLanet
          </a>
              <div class="version">
                2.5.1

              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="conduct.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installing VPLanet</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="help.html">Options and Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="src.html">C API</a></li>
<li class="toctree-l1"><a class="reference internal" href="vplot.html">VPLOT</a></li>
<li class="toctree-l1"><a class="reference internal" href="parametersweep.html">Parameter Sweep Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="architecture.html">Code Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="output.html">Add an Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="option.html">Add an Option</a></li>
<li class="toctree-l2"><a class="reference internal" href="primaryvariable.html">Add a Primary Variable</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Coupling Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#getting-started">Getting Started</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multi-module-subroutines">Multi-Module Subroutines</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multi-module-derivatives">Multi-Module Derivatives</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="module.html">Add a New Module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="http://faculty.washington.edu/rkb9/vplanet/Workshop21/">Workshop Lectures</a></li>
<li class="toctree-l1"><a class="reference internal" href="developers.html">Contributor’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="repos.html">Other VPLanet Repositories</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/VirtualPlanetaryLaboratory/vplanet">GitHub</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">VPLanet</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="tutorials.html">Tutorials</a></li>
      <li class="breadcrumb-item active">Coupling Modules</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/coupling.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="coupling-modules">
<h1>Coupling Modules<a class="headerlink" href="#coupling-modules" title="Link to this heading"></a></h1>
<p>Coupling VPLanet modules is a powerful way to study phenomena in an
interdisciplinary manner. While developing and validating a new module coupling
can be challenging, many unsolved problems in planetary evolution require
connecting physical models in novel ways. This page provides the basics for
module coupling, but it is important to remember that there is no
one-size-fits-all approach to solving these problems – every module combination
is unique. Before attempting a new module coupling, we strongly encourage you
to be familiar with developing VPLanet by, for example, adding new options
and/or outputs and fully understanding the code architecture.</p>
<section id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Link to this heading"></a></h2>
<p>The first step in coupling modules is to determine how they connect. In some
cases, one module is completely dependent on another, such as atmospheric escape
and stellar evolution, or climate and orbital evolution. In those cases, the
escape doesn’t influence the star, and the climate doesn’t impact the orbit.
These couplings are the simplest to implement as they don’t include feedbacks.
An example of a feedback is the evolution of eccentricity due to tidal damping
and planet-planet interactions: As the eccentricity decays due to tides, the
planet’s effects on other planets weakens, but the other planets continue to
pump up the tidally damping planet’s eccentricity. In practice, implementing
these two types of couplings are similar, but the second case is a bigger task
that will likely require more preparation and development time.</p>
<p>Recall that the module source files, e.g. atmesc.c, <strong>cannot</strong> contain
references to other modules. Subroutines that connect modules must be placed in
the higher level files of body.c, system.c, options.c, output.c, halt.c,
module.c.</p>
</section>
<section id="multi-module-subroutines">
<h2>Multi-Module Subroutines<a class="headerlink" href="#multi-module-subroutines" title="Link to this heading"></a></h2>
<p>Most of the work in connecting modules lies in module.c in subroutines that end
with the extension “Multi”. The three that you are most likely to use are:
VerifyMulti, ForceBehaviorMulti, PropsAuxMulti, and . The first part of module.c
contains numerous subroutines related to initializing the modules, so coupling
modules does not depend on those functions as they are required for the creation
of an individual module.</p>
<p>The first set of multi-module functions are the VerifyModuleMulti functions,
which perform the checks to ensure that a user who has selected multiple modules
for a body has chosen self-consistent input. As with single-module Verify, the
specifics of multi-nodule verification are unique to the problem. In the
subroutine you create here, you are free to include whatever checks are
necessary. At the end of each function you can add multi-module function for
PropsAux and ForceBehavior. Once you have coded up your function, add a call to
it in the actual VerifyModuleMulti function in module.c. Finally, check
VerifyModuleCompatability and remove any existing exit calls that are associated
with the new module combination.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All VerifyModuleMulti functions are called even if only 1 module has been
selected by the user because some default behavior depends on if other modules
have <em>not</em> been selected.</p>
</div>
<p>If your module coupling requires PropsAux and/or ForceBehavior functions that
are unique to the coupling, you can then add them in module.c, too. All
multi-module functions are called <em>after</em> the single-module functions, so if
something is set in one of those functions, you can change the setting in the
multi-module functions. Note that you can build as complex a multi-module
function as you like, i.e. connecting all modules, and use the VerifyMulti
framework to add/remove functions to the Control-&gt;fnPropsAuxMulti and
Control-&gt;fnForceBehaviorMulti function pointer matrices. Just be mindful of the
order in which the VerifyMulti functions are called.</p>
</section>
<section id="multi-module-derivatives">
<h2>Multi-Module Derivatives<a class="headerlink" href="#multi-module-derivatives" title="Link to this heading"></a></h2>
<p>In some case, a multi-module combination may necessitate new derivatives that
are not required for single-module runs. VPLanet also includes a framework for
this possibility with the UpdateMulti and AddModulesMulti functions in module.c.
These functions are analogous to those for single module functions. Follow the
example for semi-major axis if EqTide and STELLAR are called for a binary star
system.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="primaryvariable.html" class="btn btn-neutral float-left" title="How to Add a Primary Variable" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="module.html" class="btn btn-neutral float-right" title="Adding a New Module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2024, The VPLanet Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>